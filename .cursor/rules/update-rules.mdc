---
description: 
globs: 
alwaysApply: false
---
# Project Update Rules for CellSorter

## Mandatory Headless Development Rules

### CRITICAL: All development MUST be done in headless mode
- **NEVER show GUI during development unless explicitly specified**
- **ALL UI operations MUST work without display server**
- **Use `--headless` flag or virtual display (Xvfb) for any GUI testing**
- **Every test MUST include comprehensive UI interaction simulation**

### Interactive Testing Requirements
- **MUST test ALL clicks, drags, keyboard inputs in terminal/headless mode**
- **MUST simulate complete user workflows without display**
- **Run `pytest tests/ --headless --interactive-sim` before any updates**

## Project Structure Update Rules

### When updating project structure files

When this rule is triggered, you MUST update the `docs\PROJECT_STRUCTURE.md` file with the following exact format:

```
# CellSorter Project Structure

## File Organization

```
â”œâ”€â”€ PRODUCT_REQUIREMENTS.md          # ì œí’ˆ ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ ('ë¬´ì—‡'ê³¼ 'ì™œ')
â”œâ”€â”€ README.md                        # í”„ë¡œì íŠ¸ ê°œìš”, ì‹¤í–‰ ë°©ë²•, ì„¤ì¹˜ ë“±
â”œâ”€â”€ ARCHITECTURE.md                 # ì „ì²´ ê¸°ìˆ  ì•„í‚¤í…ì²˜ ë° ê¸°ìˆ  ìŠ¤íƒ ì„¤ëª…
â”œâ”€â”€ CODING_STYLE_GUIDE.md           # ë„¤ì´ë° ê·œì¹™, ë””ë ‰í† ë¦¬ êµ¬ì¡°, ë¬¸ì„œí™” ê·œì¹™ ë“±
â”œâ”€â”€ TESTING_STRATEGY.md             # ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ ê³„íš, ë„êµ¬, ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€
â”œâ”€â”€ CONTRIBUTING.md                 # ê°œë°œ ì°¸ì—¬ìë¥¼ ìœ„í•œ ì›Œí¬í”Œë¡œìš°ì™€ í˜‘ì—… ê°€ì´ë“œ
â”œâ”€â”€ .cursor-rules                   # Cursor AIë¥¼ ìœ„í•œ ëª…í™•í•œ í–‰ë™ ì§€ì¹¨ ì •ì˜
â”‚
â”œâ”€â”€ package.json                    # (ì„ íƒ) ì˜ì¡´ì„± ê´€ë¦¬ìš© (Pythonì´ë©´ requirements.txt)
â”œâ”€â”€ requirements.txt                # Python ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª…ì„¸
â”‚
â”œâ”€â”€ /docs/
â”‚   â”œâ”€â”€ /design/
â”‚   â”‚   â”œâ”€â”€ DESIGN_SPEC.md          # ì „ì²´ UI íë¦„, í˜ì´ì§€ë³„ ì¸í„°ë™ì…˜ ì •ì˜
â”‚   â”‚   â”œâ”€â”€ DESIGN_SYSTEM.md        # ë²„íŠ¼, ì…ë ¥ì°½ ë“± UI ì»´í¬ë„ŒíŠ¸ ì •ì˜ ë° ì†ì„±
â”‚   â”‚   â”œâ”€â”€ assets/                 # ë””ìì¸ì— ì“°ì´ëŠ” ì´ë¯¸ì§€, ì˜ˆì‹œ mockup
â”‚   â”‚   â””â”€â”€ style.css               # ì£¼ìš” ìŠ¤íƒ€ì¼ ì •ì˜ íŒŒì¼ (ë””ìì¸ ì‹œìŠ¤í…œ ê¸°ë°˜)
â”‚   â”‚
â”‚   â”œâ”€â”€ USER_PERSONAS.md            # ì£¼ìš” ì‚¬ìš©ì ìœ í˜• ì •ì˜ (í˜ë¥´ì†Œë‚˜)
â”‚   â”œâ”€â”€ USER_SCENARIOS.md           # í˜ë¥´ì†Œë‚˜ ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ (ì˜ˆ: "ì´ë¯¸ì§€ë¥¼ ìë¥´ê³  ì €ì¥")
â”‚   â””â”€â”€ RELEASE_PLAN.md             # ê¸°ëŠ¥ ë¦´ë¦¬ì¦ˆ ì¼ì • ë° ë°°í¬ ë°©ë²• ì •ë¦¬
â”‚
â”œâ”€â”€ /src/                           # PySide6 ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ
â”‚   â”œâ”€â”€ /components/                # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ /base/                  # ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸ í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ /dialogs/               # ì»¤ìŠ¤í…€ ë‹¤ì´ì–¼ë¡œê·¸
â”‚   â”‚   â””â”€â”€ /widgets/               # ì»¤ìŠ¤í…€ ìœ„ì ¯
â”‚   â”œâ”€â”€ /pages/                     # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í˜ì´ì§€/í™”ë©´
â”‚   â”œâ”€â”€ /models/                    # ë°ì´í„° ëª¨ë¸ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”œâ”€â”€ /utils/                     # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ë° í—¬í¼
â”‚   â”œâ”€â”€ /config/                    # ì„¤ì • íŒŒì¼
â”‚   â”œâ”€â”€ /assets/                    # ì•„ì´ì½˜, ì´ë¯¸ì§€ ë“± ì •ì  íŒŒì¼
â”‚   â””â”€â”€ main.py                     # ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”‚
â””â”€â”€ /tests/                         # ë‹¨ìœ„ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì½”ë“œ
    â”œâ”€â”€ /components/                # ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
    â”œâ”€â”€ /pages/                     # í˜ì´ì§€ í…ŒìŠ¤íŠ¸
    â”œâ”€â”€ /models/                    # ëª¨ë¸ í…ŒìŠ¤íŠ¸
    â””â”€â”€ /utils/                     # ìœ í‹¸ë¦¬í‹° í…ŒìŠ¤íŠ¸
```

## Directory Descriptions

### Root Level Files
- **PRODUCT_REQUIREMENTS.md**: ì œí’ˆì˜ ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œ
- **README.md**: í”„ë¡œì íŠ¸ ì„¤ì¹˜, ì‹¤í–‰, ì‚¬ìš©ë²• ê°€ì´ë“œ
- **ARCHITECTURE.md**: ê¸°ìˆ  ìŠ¤íƒ, ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜, ì„¤ê³„ ê²°ì •ì‚¬í•­
- **CODING_STYLE_GUIDE.md**: ì½”ë”© ì»¨ë²¤ì…˜, ë„¤ì´ë° ê·œì¹™, ë¬¸ì„œí™” ê·œì¹™
- **TESTING_STRATEGY.md**: í…ŒìŠ¤íŠ¸ ì „ëµ, ë„êµ¬, ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€
- **CONTRIBUTING.md**: ê¸°ì—¬ìë¥¼ ìœ„í•œ ê°œë°œ ì›Œí¬í”Œë¡œìš°

### Configuration Files
- **requirements.txt**: Python ì˜ì¡´ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª…ì„¸
- **package.json**: Node.js ì˜ì¡´ì„± (ì„ íƒì‚¬í•­)

### Documentation (/docs/)
- **design/**: UI/UX ì„¤ê³„ ê´€ë ¨ ë¬¸ì„œ
- **USER_PERSONAS.md**: íƒ€ê²Ÿ ì‚¬ìš©ì ì •ì˜
- **USER_SCENARIOS.md**: ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ë° ì›Œí¬í”Œë¡œìš°
- **RELEASE_PLAN.md**: ë¦´ë¦¬ì¦ˆ ê³„íš ë° ë°°í¬ ì „ëµ

### Source Code (/src/)
- **components/**: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸
- **pages/**: ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í™”ë©´
- **models/**: ë°ì´í„° ëª¨ë¸ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- **utils/**: ê³µí†µ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
- **config/**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
- **assets/**: ì •ì  ë¦¬ì†ŒìŠ¤ íŒŒì¼

### Tests (/tests/)
- ì†ŒìŠ¤ ì½”ë“œ êµ¬ì¡°ë¥¼ ë¯¸ëŸ¬ë§í•˜ëŠ” í…ŒìŠ¤íŠ¸ íŒŒì¼ë“¤
```

## Conda Environment and Requirements.txt Update Rules

### Conda Environment Activation
When working on the CellSorter project, you MUST:

1. **Always activate the cellsorter conda environment** before performing any Python-related tasks:
   ```bash
   . ~/.bash_profile
   conda activate cellsorter
   ```

2. **Verify the environment is active** by checking the environment name in the prompt or running:
   ```bash
   conda info --envs
   ```

### Requirements.txt Management

#### When to update requirements.txt
You MUST update the `requirements.txt` file whenever:

1. **New Python packages are installed** via conda or pip
2. **Package versions are upgraded or downgraded**
3. **Packages are removed from the environment**
4. **Development setup changes**
5. **Before committing any code changes**

#### Requirements.txt Update Process

1. **Activate the cellsorter environment**:
   ```bash
   conda activate cellsorter
   ```

2. **Generate requirements from conda environment**:
   ```bash
   pip freeze > requirements.txt
   ```

3. **Alternative method using conda list**:
   ```bash
   conda list --export > environment.yml
   # Then convert to requirements.txt format if needed
   ```

4. **Clean up the requirements.txt file**:
   - Remove system-specific paths
   - Remove unnecessary build numbers
   - Keep only essential packages
   - Use compatible version specifiers (>=, ==, ~=)

#### Requirements.txt Format Standards

The requirements.txt file MUST follow these standards:

```txt
# Core PySide6 Framework
PySide6>=6.4.0

# Image Processing
opencv-python>=4.8.0
numpy>=1.24.0
Pillow>=10.0.0

# Data Analysis
pandas>=2.0.0
matplotlib>=3.7.0

# Testing Framework
pytest>=7.4.0
pytest-qt>=4.2.0

# Development Tools
black>=23.0.0
flake8>=6.0.0
mypy>=1.5.0

# Build Tools
pyinstaller>=5.13.0
```

#### Package Installation Priority

1. **First priority**: Install via conda when available
   ```bash
   conda install package_name
   ```

2. **Second priority**: Install via pip when not available in conda
   ```bash
   pip install package_name
   ```

3. **Always update requirements.txt** after any installation
   ```bash
   pip freeze > requirements.txt
   ```

#### Environment Synchronization

When other developers join the project:

1. **Create the environment**:
   ```bash
   conda create --name cellsorter python=3.11
   ```

2. **Activate the environment**:
   ```bash
   conda activate cellsorter
   ```

3. **Install from requirements.txt**:
   ```bash
   pip install -r requirements.txt
   ```

#### Pre-commit Requirements Check

Before any git commit, you MUST:

1. **Activate cellsorter environment**
2. **Update requirements.txt if packages changed**
3. **Verify requirements.txt is current**:
   ```bash
   pip check
   pip freeze > temp_requirements.txt
   diff requirements.txt temp_requirements.txt
   rm temp_requirements.txt
   ```

#### Development vs Production Requirements

Maintain separate requirements if needed:

- **requirements.txt**: Production dependencies only
- **requirements-dev.txt**: Development and testing dependencies
- **requirements-build.txt**: Build and deployment dependencies

#### Conda Environment Backup

Regularly backup the conda environment:

```bash
conda env export --name cellsorter > environment.yml
```

This creates a complete environment specification including conda packages.

### Automated Requirements Update

When this rule is triggered, automatically:

1. **Check if cellsorter environment exists**
2. **Activate the environment**
3. **Generate updated requirements.txt**
4. **Clean and format the file**
5. **Commit changes if requirements differ**

Example automation script reference:
```bash
#!/bin/bash
conda activate cellsorter
if [ $? -eq 0 ]; then
    pip freeze > requirements.txt
    echo "requirements.txt updated successfully"
else
    echo "Error: cellsorter environment not found or activation failed"
    exit 1
fi
```

## README.md Auto-Update Rules

### When to update README.md

You MUST automatically update the README.md file whenever:

1. **New files are added to the project**
2. **Project structure changes**
3. **Dependencies are modified**
4. **Installation steps change**
5. **Usage instructions need updates**

### Update Process

1. **Analyze git diff**: Check what files have been added, modified, or deleted
2. **Review commit messages**: Understand the nature of changes
3. **Update relevant sections**: Modify README.md sections accordingly

### README.md Structure to Maintain

```markdown
# CellSorter

## ğŸ“‹ Overview
[Brief description of the application]

## ğŸš€ Features
[List of main features - update when new features are added]

## ğŸ› ï¸ Technology Stack
[Update when dependencies change]

## ğŸ“ Project Structure
[Update when file structure changes]

## âš™ï¸ Installation
[Update when setup process changes]

## ğŸ¯ Usage
[Update when usage instructions change]

## ğŸ§ª Testing
[Update when testing setup changes]

## ğŸ“– Documentation
[Update when documentation files are added/modified]

## ğŸ¤ Contributing
[Update based on CONTRIBUTING.md changes]

## ğŸ“„ License
[License information]
```

### Specific Update Triggers

#### When new source files are added:
- Update **Project Structure** section
- Update **Features** section if new functionality
- Update **Usage** section if new user-facing features

#### When dependencies change:
- Update **Technology Stack** section
- Update **Installation** section
- Update **Requirements** section

#### When documentation files are added/modified:
- Update **Documentation** section
- Add links to new documentation files
- Update navigation references

#### When test files are added:
- Update **Testing** section
- Update **Installation** section if new test dependencies

#### When configuration files change:
- Update **Installation** section
- Update **Usage** section if configuration affects usage

### Auto-Update Commands

When performing README updates, include these actions:

1. **Check git status**: `git status --porcelain`
2. **Review recent commits**: `git log --oneline -10`
3. **Analyze file changes**: `git diff --name-status HEAD~1`
4. **Update sections accordingly**
5. **Maintain consistency** with other documentation files

### Content Synchronization Rules

- **Always sync** with ARCHITECTURE.md for technology stack
- **Always sync** with CONTRIBUTING.md for contribution guidelines
- **Always sync** with requirements.txt for dependencies
- **Always sync** with project structure for file organization
- **Always reference** relevant documentation files

### Format Requirements

- Use **emoji headers** for better readability
- Include **table of contents** for long READMEs
- Use **code blocks** for installation commands
- Include **screenshots** for UI applications
- Add **badges** for build status, coverage, etc.
- Maintain **consistent formatting** throughout

## Execution Priority

1. **First**: Activate cellsorter conda environment
2. **Second**: Update requirements.txt from conda environment
3. **Third**: Update `docs/design/project_structure.md`
4. **Fourth**: Analyze git changes and commit history
5. **Fifth**: Update README.md based on analysis
6. **Sixth**: Ensure all cross-references are updated
7. **Seventh**: Validate all links and references work correctly

These rules ensure that project documentation stays current and accurate with every change made to the codebase.




